<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<title>Rejestracja czasu pracy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
background-color: black;
color: orange;
font-family: Arial, sans-serif;
text-align: center;
margin: 0;
padding: 0;
font-size: 18px;
}
.container {
display: flex;
flex-direction: column;
align-items: center;
justify-content: flex-end;
min-height: 100vh;
padding: 20px 20px 1000px;
text-align: center;
transform: scale(0.75) translateY(-10vh);
transform-origin: top center;
}
img.logo {
max-width: 90%;
height: auto;
margin-bottom: 30px;
}
select, button {
width: 100%;
padding: 16px;
margin: 12px 0;
font-size: 18px;
border: none;
border-radius: 6px;
}
select { background-color: #333; color: orange; }
button {
background-color: orange;
color: black;
font-weight: bold;
transition: all 0.1s ease;
}
.button-row {
display: flex;
justify-content: space-between;
gap: 10px;
margin-bottom: 20px;
}
.button-row button { flex: 1; }
button:active {
transform: scale(0.95);
background-color: #ff9900;
box-shadow: 0 2px 4px rgba(0,0,0,0.5) inset;
}
#status { margin-top: 20px; font-size: 16px; }
.status-box { margin-top: 20px; font-size: 20px; font-weight: bold; }
.spinner {
border: 6px solid #f3f3f3;
border-top: 6px solid orange;
border-radius: 50%;
width: 50px;
height: 50px;
animation: spin 1s linear infinite;
margin: 30px auto 0;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>
</head>
<body>
<div class="container">
<img src="logo4.png" alt="Logo" class="logo" />

<div class="button-row" id="spawalniaButtons">
<button id="btnSpawalniaStart" onclick="potwierdzSpawalnia('START')">ROZPOCZNIJ PRACƒò</button>
<button id="btnSpawalniaStop" onclick="potwierdzSpawalnia('STOP')">ZAKO≈ÉCZ PRACƒò</button>
</div>

<h2>WYBIERZ PROJEKT</h2>
<select id="projekt" disabled>
<option value="WP41 - 241011008">WP41 - 241011008</option>
<option value="M3 - 241011006">M3 - 241011006</option>
<option value="Area C - 241011011">Area C - 241011011</option>
<option value="PGI Izolacja - 241011012">PGI Izolacja - 241011012</option>
<option value="Lilly - 251011005">Lilly - 251011005</option>
<option value="PGI Zbiornik - 251011002">PGI Zbiornik - 251011002</option>
<option value="PGI Wyspa - 251011003">PGI Wyspa - 251011003</option>
</select>

<div id="projectButtons">
<button id="btnStart" onclick="potwierdz('START')">START</button>
<button id="btnStop" onclick="potwierdz('STOP')">STOP</button>
<button id="btnStopAll" onclick="zakonczWszystko()">STOP i ZAKO≈ÉCZ PRACƒò</button>
</div>

<p id="status"></p>
<div class="status-box" id="projektInfo"></div>
<div id="loader" class="spinner" style="display: none;"></div>
</div>

<script>
const BASE_URL = "https://script.google.com/macros/s/AKfycby_JU37bdp8D4r9L3Lxa2OzeLja-zln_mFkSZxQ4ws2vluMdFgae4GprzF0gwOuRJw/exec"; // wklej URL Web App Apps Script

const blokadaKlikniec = {};
function blokujPrzycisk(id) {
const btn = document.getElementById(id);
if(btn.disabled) return true;
btn.disabled = true;
blokadaKlikniec[id] = true;
setTimeout(()=>{ btn.disabled=false; blokadaKlikniec[id]=false; },15000);
return false;
}

function getParam(name) {
return new URLSearchParams(window.location.search).get(name);
}

// pobierz status u≈ºytkownika i ustaw UI
async function pobierzStatus(){
const id = getParam('u') || 'Nieznany';
try{
const resp = await fetch(`${BASE_URL}?u=${id}`);
const status = await resp.json();
localStorage.removeItem('spawalnia');
localStorage.removeItem('aktywnyProjekt');
if(status.Spawalnia) localStorage.setItem('spawalnia','true');
if(status.AktywnyProjekt) localStorage.setItem('aktywnyProjekt', status.AktywnyProjekt);
aktualizujUI();
} catch(e){
console.error(e);
document.getElementById('status').innerText='‚ùåB≈ÅƒÑD PO≈ÅƒÑCZENIA';
}
}

async function wyslijDane(projekt, akcja){
const id = getParam('u') || 'Nieznany';
document.getElementById('loader').style.display='block';
try{
const resp = await fetch(BASE_URL, {
method:'POST',
headers:{'Content-Type':'application/json'},
body: JSON.stringify({id, projekt, akcja})
});
const json = await resp.json();
document.getElementById('loader').style.display='none';
pobierzStatus();
} catch(e){
document.getElementById('loader').style.display='none';
document.getElementById('status').innerText='‚ùåB≈ÅƒÑD PO≈ÅƒÑCZENIA';
}
}

// START/STOP projektu
function potwierdz(akcja){
const btnId = akcja==='START'?'btnStart':'btnStop';
if(blokujPrzycisk(btnId)) return;
const projekt = document.getElementById('projekt').value;
if(akcja==='START' && !localStorage.getItem('spawalnia')) return alert('Musisz najpierw rozpoczƒÖƒá Spawalniƒô!');
if(confirm(`${akcja==='START'?'RozpoczƒÖƒá':'Zako≈Ñczyƒá'} pracƒô na projekcie "${projekt}"?`)){
wyslijDane(projekt, akcja);
}
}

// START/STOP spawalni
function potwierdzSpawalnia(akcja){
const btnId = akcja==='START'?'btnSpawalniaStart':'btnSpawalniaStop';
if(blokujPrzycisk(btnId)) return;
const projekt = "Spawalnia";
if(confirm(`${akcja==='START'?'RozpoczƒÖƒá':'Zako≈Ñczyƒá'} pracƒô na Spawalni?`)){
wyslijDane(projekt, akcja);
}
}

// STOP wszystko
function zakonczWszystko(){
const aktywny = localStorage.getItem('aktywnyProjekt');
if(!aktywny) return alert('Nie ma aktywnego projektu!');
if(confirm(`Zako≈Ñczyƒá "${aktywny}" i Spawalniƒô?`)){
wyslijDane(aktywny,'STOP');
wyslijDane('Spawalnia','STOP');
}
}

// aktualizacja UI
function aktualizujUI(){
const spawalnia = localStorage.getItem('spawalnia');
const aktywny = localStorage.getItem('aktywnyProjekt');
document.getElementById('projekt').disabled = !spawalnia;
document.getElementById('btnStart').style.display = (spawalnia && !aktywny)?'inline-block':'none';
document.getElementById('btnStop').style.display = aktywny?'inline-block':'none';
document.getElementById('btnStopAll').style.display = spawalnia?'inline-block':'none';
document.getElementById('projektInfo').innerText = aktywny?`üî∏ Obecnie pracujesz na projekcie: ${aktywny}`:spawalnia?'üî∏ Spawalnia aktywna':'';
}

// start
pobierzStatus();
</script>
</body>
</html>
